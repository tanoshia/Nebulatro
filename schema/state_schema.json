{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://nebulatro.local/schema/state.schema.json",
  "title": "Nebulatro Canonical Game State",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "schema_version",
    "screen",
    "hand",
    "played_cards",
    "jokers",
    "economy",
    "round",
    "score",
    "rng_visible"
  ],
  "properties": {
    "schema_version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+(\\.\\d+)?$"
    },
    "screen": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "type",
        "substate"
      ],
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "play",
            "shop",
            "pack",
            "blind_select",
            "menu",
            "unknown"
          ]
        },
        "substate": {
          "type": "string",
          "minLength": 1
        }
      }
    },
    "hand": {
      "type": "array",
      "minItems": 0,
      "maxItems": 10,
      "items": {
        "$ref": "#/$defs/card_instance"
      }
    },
    "played_cards": {
      "type": "array",
      "minItems": 0,
      "items": {
        "$ref": "#/$defs/card_instance"
      }
    },
    "jokers": {
      "type": "array",
      "minItems": 0,
      "maxItems": 10,
      "items": {
        "$ref": "#/$defs/joker_instance"
      }
    },
    "vouchers": { 
      "$ref": "#/$defs/vouchers_owned" 
    },
    "economy": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "money",
        "interest_cap"
      ],
      "properties": {
        "money": {
          "type": "integer",
          "minimum": 0,
          "maximum": 999
        },
        "interest_cap": {
          "type": "integer",
          "minimum": 0,
          "maximum": 99
        }
      }
    },
    "round": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "ante",
        "blind",
        "hands_left",
        "discards_left"
      ],
      "properties": {
        "ante": {
          "type": "integer",
          "minimum": 0,
          "maximum": 99
        },
        "blind": {
          "type": "string",
          "enum": [
            "small",
            "big",
            "boss",
            "unknown"
          ]
        },
        "hands_left": {
          "type": "integer",
          "minimum": 0,
          "maximum": 99
        },
        "discards_left": {
          "type": "integer",
          "minimum": 0,
          "maximum": 99
        }
      }
    },
    "score": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "current",
        "required"
      ],
      "properties": {
        "current": {
          "type": "integer",
          "minimum": 0
        },
        "required": {
          "type": "integer",
          "minimum": 0
        }
      }
    },
    "rng_visible": {
      "type": "boolean"
    },
    "meta": {
      "type": "object",
      "additionalProperties": true,
      "properties": {
        "timestamp": {
          "type": "integer",
          "minimum": 0
        },
        "resolution": {
          "type": "array",
          "minItems": 2,
          "maxItems": 2,
          "items": {
            "type": "integer",
            "minimum": 1,
            "maximum": 16384
          }
        },
        "source_image_id": {
          "type": "string"
        },
        "notes": {
          "type": "string"
        }
      }
    }
  },
  "$defs": {
    "rank": {
      "type": "string",
      "enum": [
        "2",
        "3",
        "4",
        "5",
        "6",
        "7",
        "8",
        "9",
        "10",
        "J",
        "Q",
        "K",
        "A"
      ]
    },
    "suit": {
      "type": "string",
      "enum": [
        "spades",
        "hearts",
        "clubs",
        "diamonds"
      ]
    },
    "edition": {
      "type": [
        "string",
        "null"
      ],
      "enum": [
        "foil",
        "holographic",
        "polychrome",
        null
      ]
    },
    "seal": {
      "type": [
        "string",
        "null"
      ],
      "enum": [
        "gold",
        "purple",
        "red",
        "blue",
        null
      ]
    },
    "enhancement": {
      "type": "string",
      "enum": [
        "bonus",
        "mult",
        "wild",
        "lucky",
        "glass",
        "steel",
        "stone",
        "gold"
      ]
    },
    "card_instance": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "id",
        "rank",
        "suit",
        "edition",
        "enhancements",
        "seal"
      ],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^(2|3|4|5|6|7|8|9|10|J|Q|K|A)_(spades|hearts|clubs|diamonds)$"
        },
        "rank": {
          "$ref": "#/$defs/rank"
        },
        "suit": {
          "$ref": "#/$defs/suit"
        },
        "edition": {
          "$ref": "#/$defs/edition"
        },
        "enhancements": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/enhancement"
          },
          "uniqueItems": true
        },
        "seal": {
          "$ref": "#/$defs/seal"
        },
        "debuff": {
          "type": "boolean",
          "default": false
        }
      }
    },
    "joker_instance": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "id",
        "slot",
        "edition"
      ],
      "properties": {
        "id": {
          "type": "string",
          "minLength": 1
        },
        "slot": {
          "type": "integer",
          "minimum": 0,
          "maximum": 9
        },
        "edition": {
          "$ref": "#/$defs/edition"
        },
        "debuff": {
          "type": "boolean",
          "default": false
        }
      }
    },
    "voucher_owned": {
      "type": "object",
      "additionalProperties": false,
      "required": ["id"],
      "properties": {
        "id": { "type": "string", "minLength": 1 }
      }
    },
    "vouchers_owned": {
      "type": "array",
      "items": { "$ref": "#/$defs/voucher_owned" },
      "uniqueItems": false
    },
    "shop_offer": {
      "type": "object",
      "additionalProperties": false,
      "required": ["type", "id", "price"],
      "properties": {
        "type": { "type": "string", "enum": ["joker", "voucher", "pack", "consumable", "card"] },
        "id": { "type": "string", "minLength": 1 },
        "price": { "type": "integer", "minimum": 0, "maximum": 999 }
      }
    },
    "shop": {
      "type": "object",
      "additionalProperties": false,
      "required": ["offers"],
      "properties": {
        "offers": {
          "type": "array",
          "items": { "$ref": "#/$defs/shop_offer" }
        },
        "rerolls_used": { "type": "integer", "minimum": 0, "maximum": 99 }
      }
    }
  }
}